/*!
 * product-filter.js
 *
 * Copyright (c) "kento" Karim Rahimpur www.itthinx.com
 *
 * This code is provided subject to the license granted.
 * Unauthorized use and distribution is prohibited.
 * See COPYRIGHT.txt and LICENSE.txt
 *
 * This code is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 *
 * This header and all notices must be kept intact.
 *
 * @author itthinx
 * @package woocommerce-product-search
 * @since 2.0.0
 */
;var ixwpsf={blinkerTimeouts:[],blinkerTimeout:5000,productsBlinker:false,taxonomy:[],ts:0,autoToggleFilterWidgets:true,embed:true,expandTime:200,retractTime:320};(function(a){ixwpsf.productFilter=function(d,h,b){var q=decodeURI(window.location.href),s=false,g=a(h.products).filter(function(){return a(this).closest(".related.products").length<1}),l=g.css("width"),j=g.css("height"),p=ixwpsf.blinkerTimeout,t=true,e=true;if(typeof b.href!=="undefined"){if(q!==b.href){q=b.href;s=true}}if(typeof b.term!=="undefined"){var c=new RegExp("ixwpst\\["+b.taxonomy+"\\]\\[[0-9]+\\]","g");q=q.replace(c,"ixwpst["+b.taxonomy+"][]");switch(b.action){case"add":q=ixwpsf.addQueryArg("ixwpst["+b.taxonomy+"][]",b.term,q);break;case"remove":q=ixwpsf.removeQueryArg("ixwpst["+b.taxonomy+"][]",b.term,q);break;default:q=ixwpsf.updateQueryArg("ixwpst["+b.taxonomy+"][]",b.term,q)}}var r="";if(typeof b.min_price!=="undefined"){q=ixwpsf.updateQueryArg("min_price",b.min_price,q);r+=b.min_price}else{var n=ixwpsf.getQueryArg(q,"min_price");if(n!==null&&n.length>0){r+=n}}if(typeof b.max_price!=="undefined"){q=ixwpsf.updateQueryArg("max_price",b.max_price,q);r+=b.max_price}else{var k=ixwpsf.getQueryArg(q,"max_price");if(k!==null&&k.length>0){r+=k}}var f=r.length>0?"1":"";q=ixwpsf.updateQueryArg("ixwpsp",f,q);if(f!==""){b.ixwpsp=f}if(typeof b.blinkerTimeout!=="undefined"){p=b.blinkerTimeout}if(typeof b.updateAddressBar!=="undefined"){t=b.updateAddressBar}if(typeof b.updateDocumentTitle!=="undefined"){e=b.updateDocumentTitle}d=a.trim(d);q=ixwpsf.updateQueryArg("ixwpss",encodeURIComponent(d),q);if(typeof b.title!=="undefined"){q=ixwpsf.updateQueryArg("title",b.title,q)}if(typeof b.excerpt!=="undefined"){q=ixwpsf.updateQueryArg("excerpt",b.excerpt,q)}if(typeof b.content!=="undefined"){q=ixwpsf.updateQueryArg("content",b.content,q)}if(typeof b.categories!=="undefined"){q=ixwpsf.updateQueryArg("categories",b.categories,q)}if(typeof b.attributes!=="undefined"){q=ixwpsf.updateQueryArg("attributes",b.attributes,q)}if(typeof b.tags!=="undefined"){q=ixwpsf.updateQueryArg("tags",b.tags,q)}if(typeof b.sku!=="undefined"){q=ixwpsf.updateQueryArg("sku",b.sku,q)}if(typeof b.order_by!=="undefined"){q=ixwpsf.updateQueryArg("order_by",b.order_by,q)}if(typeof b.order!=="undefined"){q=ixwpsf.updateQueryArg("order",b.order,q)}if(typeof b.wpml!=="undefined"){q=ixwpsf.updateQueryArg("wpml",b.wpml,q)}if(typeof b.terms!=="undefined"){q=ixwpsf.updateQueryArg("terms",b.terms,q)}if(ixwpsf.taxonomy.length>0){for(var o=0;o<ixwpsf.taxonomy.length;o++){if(typeof ixwpsf.taxonomy[o].show!=="undefined"){q=ixwpsf.addQueryArg("ixwpsf[taxonomy]["+ixwpsf.taxonomy[o].taxonomy+"][show]",ixwpsf.taxonomy[o].show,q)}if(typeof ixwpsf.taxonomy[o].multiple!=="undefined"){q=ixwpsf.addQueryArg("ixwpsf[taxonomy]["+ixwpsf.taxonomy[o].taxonomy+"][multiple]",ixwpsf.taxonomy[o].multiple?1:0,q)}if(typeof ixwpsf.taxonomy[o].filter!=="undefined"){q=ixwpsf.addQueryArg("ixwpsf[taxonomy]["+ixwpsf.taxonomy[o].taxonomy+"][filter]",ixwpsf.taxonomy[o].filter?1:0,q)}}}a(h.field).addClass("blinker");if(ixwpsf.productsBlinker){g.addClass("product-search-filter-blinker").html("").show()}g.css("minWidth",l);g.css("minHeight",j);a(h.pagination).hide();a(h.count).hide();if(p>0){ixwpsf.blinkerTimeouts[h.field]=setTimeout(function(){a(h.field).removeClass("blinker")},p);ixwpsf.blinkerTimeouts[h.products]=setTimeout(function(){g.removeClass("product-search-filter-blinker")},p)}var u=(typeof Date.now==="function")?Date.now():0;var m=ixwpsf.updateQueryArg("ixmbd",ixwpsf.embed?"1":"",q);a.ajax({url:m,success:function(v,i,B){if(u>=ixwpsf.ts){ixwpsf.ts=u}else{return}var x=a(v).find(h.breadcrumb);if(x.length>0){a(h.breadcrumb).replaceWith(x);a(h.breadcrumb).show()}else{a(h.breadcrumb).html("");a(h.breadcrumb).hide()}var w=a(v).find(h.header);if(w.length>0){a(h.header).replaceWith(w);a(h.header).show()}else{a(h.header).html("");a(h.header).hide()}a(h.field).removeClass("blinker");if(ixwpsf.productsBlinker){g.removeClass("product-search-filter-blinker")}else{g.html("").show()}if(p>0){clearTimeout(ixwpsf.blinkerTimeouts[h.field]);clearTimeout(ixwpsf.blinkerTimeouts[h.products])}var A=a(v).find(h.products).filter(function(){return a(this).closest(".related.products").length<1});if(a(A).find(".product").length>0){if(g.length>0){g.show().replaceWith(A)}else{a(h.header).parent().replaceWith(a(v).find(h.header).parent())}a(h.info).remove();a(h.ordering).show()}else{if(g.length>0){a(h.info).remove();g.html("").hide().after(a(v).find(h.info));a(h.ordering).hide()}}var C=a(v).find(h.pagination);a.each(a(h.pagination),function(D,E){if(C.eq(D).length>0){a(h.pagination).eq(D).replaceWith(C.eq(D))}else{a(h.pagination).eq(D).html("")}});var z=a(v).find(h.count);a.each(a(h.count),function(D,E){if(z.eq(D).length>0){a(h.count).eq(D).replaceWith(z.eq(D))}else{a(h.count).eq(D).html("")}});a(h.pagination).show();a(h.count).show();if(!s){if(t){window.history.pushState({query:d,href:q},"",q)}if(e){var y=a(v).filter("title").text();document.title=y}}ixwpsf.updateOrderingForm(d,h,b,q);a(".product-search-filter-terms").each(function(){var D=a(v).find("#"+this.id);if(D.length>0){a("#"+this.id).replaceWith(D);a(D).find(".product-search-product_cat-filter-item a").on("click",ixwpsf.categoryFilterItemOnClick);a(D).find(".product-search-product_tag-filter-item").on("click",ixwpsf.tagFilterItemOnClick);a(D).find(".product-search-attribute-filter-item a").on("click",ixwpsf.attributeFilterItemOnClick);ixwpsf.toggleWidgets()}})}})};ixwpsf.updateOrderingForm=function(f,o,e,u){var j=a(o.ordering).closest("form");if(j.length>0){if(f.length>0){var g=a(j).find('input[name="ixwpss"]');if(g.length>0){g.val(f)}else{a(j).append('<input type="hidden" name="ixwpss" value="'+f+'"/>')}}if(typeof e.title!=="undefined"){var x=a(j).find('input[name="title"]');if(x.length>0){x.val(e.title)}else{a(j).append('<input type="hidden" name="title" value="'+e.title+'"/>')}}else{a(j).find('input[name="title"]').remove()}if(typeof e.excerpt!=="undefined"){var c=a(j).find('input[name="excerpt"]');if(c.length>0){c.val(e.excerpt)}else{a(j).append('<input type="hidden" name="excerpt" value="'+e.excerpt+'"/>')}}else{a(j).find('input[name="excerpt"]').remove()}if(typeof e.content!=="undefined"){var s=a(j).find('input[name="content"]');if(s.length>0){s.val(e.content)}else{a(j).append('<input type="hidden" name="content" value="'+e.content+'"/>')}}else{a(j).find('input[name="content"]').remove()}if(typeof e.categories!=="undefined"){var q=a(j).find('input[name="categories"]');if(q.length>0){q.val(e.categories)}else{a(j).append('<input type="hidden" name="categories" value="'+e.categories+'"/>')}}else{a(j).find('input[name="categories"]').remove()}if(typeof e.attributes!=="undefined"){var k=a(j).find('input[name="attributes"]');if(k.length>0){k.val(e.attributes)}else{a(j).append('<input type="hidden" name="attributes" value="'+e.attributes+'"/>')}}else{a(j).find('input[name="attributes"]').remove()}if(typeof e.tags!=="undefined"){var m=a(j).find('input[name="tags"]');if(m.length>0){m.val(e.tags)}else{a(j).append('<input type="hidden" name="tags" value="'+e.tags+'"/>')}}else{a(j).find('input[name="tags"]').remove()}if(typeof e.sku!=="undefined"){var n=a(j).find('input[name="sku"]');if(n.length>0){n.val(e.sku)}else{a(j).append('<input type="hidden" name="sku" value="'+e.sku+'"/>')}}else{a(j).find('input[name="sku"]').remove()}if(typeof e.wpml!=="undefined"){var l=a(j).find('input[name="wpml"]');if(l.length>0){l.val(e.wpml)}else{a(j).append('<input type="hidden" name="wpml" value="'+e.wpml+'"/>')}}else{a(j).find('input[name="wpml"]').remove()}a(j).find('input[name="min_price"]').remove();a(j).find('input[name="max_price"]').remove();a(j).find('input[name^="ixwpst"]').remove();a(j).find('input[name^="ixwpsf"]').remove();var v=u.substring(u.indexOf("?")+1);var d=v.indexOf("#");if(d>=0){v=v.substring(0,d)}v=v.split("&");if(v.length>0){for(var t=0;t<v.length;t++){var p=v[t].split("="),w="",r="";w=unescape(p[0]);if(p.length>1){r=unescape(p[1])}if(w!==""&&w!=="orderby"&&w!=="ixwpss"&&w!=="title"&&w!=="excerpt"&&w!=="content"&&w!=="categories"&&w!=="attributes"&&w!=="tags"&&w!=="sku"&&w!=="wpml"&&(w==="min_price"||w==="max_price"||w.indexOf("ixwpst")===0||w.indexOf("ixwpsf")===0)){var b=a(j).find('input[name="'+w+'"]');if(b.length>0&&!w.endsWith("[]")){b.val(r)}else{a(j).append(a('<input type="hidden" name="'+w+'" />').attr({value:r}))}}}}if(typeof e.ixwpsp!=="undefined"){var h=a(j).find('input[name="ixwpsp"]');if(h.length>0){h.val(e.ixwpsp)}else{a(j).append('<input type="hidden" name="ixwpsp" value="'+e.ixwpsp+'"/>')}}else{a(j).find('input[name="ixwpsp"]').remove()}}};ixwpsf.updateQueryArg=function(i,h,b){b=ixwpsf.decodeURI(b);var c=i.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),g=new RegExp("([?&])"+c+"=.*?(&|#|$)","g"),j=null;if(typeof b==="undefined"){b=window.location.href}if(h===""){g=new RegExp("([?&])"+c+"=([^&#$]*)","g");j=b.replace(g,"$1");j=j.replace("?&","?").replace(/&&+/g,"&").replace(/&$/,"")}else{var e;if(e=b.match(g)){j=b.replace(g,"$1"+i+"="+h+"$2")}else{var d="",f=b.indexOf("?")!==-1?"&":"?";if(b.indexOf("#")!==-1){d=b.replace(/.*#/,"#");b=b.replace(/#.*/,"")}j=b+f+i+"="+h+d}}return j};ixwpsf.getQueryArgs=function(b){b=ixwpsf.decodeURI(b);var d=/[^=&?]+\s*=\s*[^&#]*/g;var f=b.match(d);var e=[];if(f!==null){for(var c=0;c<f.length;c++){var g=f[c].split("=");e.push(g)}}return e};ixwpsf.getQueryArg=function(c,e){c=ixwpsf.decodeURI(c);var f=new RegExp("[&?]"+e+"s*=s*[^&#]*","g");var g=c.match(f);var b=null;if(g!==null){for(var d=0;d<g.length;d++){var h=g[d].split("=");b=h[1];break}}return b};ixwpsf.addQueryArg=function(d,f,b){b=ixwpsf.decodeURI(b);var j=true;if(typeof b==="undefined"){b=window.location.href}var e=ixwpsf.getQueryArgs(b);for(var c=0;c<e.length;c++){if(e[c][0]==d&&e[c][1]==f){j=false;break}}if(j){var h="",g=b.indexOf("?")!==-1?"&":"?";if(b.indexOf("#")!==-1){h=b.replace(/.*#/,"#");b=b.replace(/#.*/,"")}b=b+g+d+"="+f+h}return b};ixwpsf.removeQueryArg=function(e,g,d){d=ixwpsf.decodeURI(d);var c=e.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),f=new RegExp("([?&])"+c+"="+g+"(&|#|$)","i"),b=d.replace(f,"$1$2").replace("?&","?").replace(/&&+/g,"&").replace(/&$/,"");return b};ixwpsf.categoryFilterItemOnClick=function(g){var d=a(this).closest(".product-search-filter-terms"),c=a(d).data("multiple"),b=a(this).parent().data("term")==="";if(c&&!b){var f="add"}else{var f="replace"}if(typeof g.preventDefault==="function"){g.preventDefault()}if(typeof g.stopImmediatePropagation==="function"){g.stopImmediatePropagation()}if(typeof g.stopPropagation==="function"){g.stopPropagation()}if(a(this).parent().hasClass("current-cat")){a(this).addClass("loading-term-filter");if(c){a(this).parent().removeClass("current-cat");a(".product-filter-field").first().trigger("ixTermFilter",[a(this).parent().data("term"),"product_cat","remove"])}else{a(".product-search-product_cat-filter-item").removeClass("current-cat");a(".product-filter-field").first().trigger("ixTermFilter",["","product_cat"])}}else{if(!c){a(".product-search-product_cat-filter-item").removeClass("current-cat")}a(this).parent().addClass("current-cat");a(this).addClass("loading-term-filter");a(".product-filter-field").first().trigger("ixTermFilter",[a(this).parent().data("term"),"product_cat",f])}return false};ixwpsf.tagFilterItemOnClick=function(g){var d=a(this).closest(".product-search-filter-terms"),c=a(d).data("multiple"),b=a(this).data("term")==="";if(c&&!b){var f="add"}else{var f="replace"}if(typeof g.preventDefault==="function"){g.preventDefault()}if(typeof g.stopImmediatePropagation==="function"){g.stopImmediatePropagation()}if(typeof g.stopPropagation==="function"){g.stopPropagation()}if(a(this).hasClass("current-tag")){a(this).addClass("loading-term-filter");if(c){a(this).removeClass("current-tag");a(".product-filter-field").first().trigger("ixTermFilter",[a(this).data("term"),"product_tag","remove"])}else{a(".product-search-product_tag-filter-item").removeClass("current-tag");a(".product-filter-field").first().trigger("ixTermFilter",["","product_tag"])}}else{if(!c){a(".product-search-product_tag-filter-item").removeClass("current-tag")}a(this).addClass("current-tag");a(this).addClass("loading-term-filter");a(".product-filter-field").first().trigger("ixTermFilter",[a(this).data("term"),"product_tag",f])}return false};ixwpsf.attributeFilterItemOnClick=function(g){var d=a(this).closest(".product-search-filter-terms"),c=a(d).data("multiple"),b=a(this).parent().data("term")==="";if(c&&!b){var f="add"}else{var f="replace"}if(typeof g.preventDefault==="function"){g.preventDefault()}if(typeof g.stopImmediatePropagation==="function"){g.stopImmediatePropagation()}if(typeof g.stopPropagation==="function"){g.stopPropagation()}if(a(this).parent().hasClass("current-attribute")){a(".product-search-"+a(this).parent().data("taxonomy")+"-filter-item").removeClass("current-attribute");a(this).addClass("loading-term-filter");if(c){a(".product-filter-field").first().trigger("ixTermFilter",[a(this).parent().data("term"),a(this).parent().data("taxonomy"),"remove"])}else{a(".product-filter-field").first().trigger("ixTermFilter",["",a(this).parent().data("taxonomy")])}}else{a(this).parent().addClass("current-attribute");a(this).addClass("loading-term-filter");if(a(this).parent().data("term")==="undefined"||a(this).parent().data("term")===""){a(".product-filter-field").first().trigger("ixTermFilter",["",a(this).parent().data("taxonomy")])}else{a(".product-filter-field").first().trigger("ixTermFilter",[a(this).parent().data("term"),a(this).parent().data("taxonomy"),f])}}return false};ixwpsf.decodeURI=function(b){try{b=decodeURI(b)}catch(c){b=b.replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%20/g," ")}return b};ixwpsf.toggleWidgets=function(){if(ixwpsf.autoToggleFilterWidgets){a(".product-search-filter-items").each(function(){a(this).closest(".widget").toggle(a(this).children().length>0)})}};a(document).ready(function(){a(document).on("mouseenter",".expandable.auto-expand",function(d){if(typeof d.preventDefault==="function"){d.preventDefault()}if(typeof d.stopImmediatePropagation==="function"){d.stopImmediatePropagation()}if(typeof d.stopPropagation==="function"){d.stopPropagation()}var e=a(this).find(".term-expander").first();var b=false;if(typeof e.data("locked")!=="undefined"){b=e.data("locked")}if(b){return}a(this).addClass("expanded");var c=a(this).find("> ul");c.stop(true,true).show(ixwpsf.expandTime);if(a(this).hasClass("auto-retract")){a(this).closest(".product-search-filter-items").on("mouseleave.ixwpsf",function(f){c.parent().removeClass("expanded");c.stop(true,true).hide(ixwpsf.retractTime);a(this).off("mouseleave.ixwpsf")})}});a(document).on("click touchstart",".term-expander",function(g){if(typeof g.preventDefault==="function"){g.preventDefault()}if(typeof g.stopImmediatePropagation==="function"){g.stopImmediatePropagation()}if(typeof g.stopPropagation==="function"){g.stopPropagation()}var h=a(this).closest(".term-expander");var e=false;var c=false;if(typeof h.data("locked")!=="undefined"){c=h.data("locked")}switch(c){case true:e=true;break;default:h.data("locked",true);var b=setTimeout(function(){h.data("locked",false);h.data("lockedTimeout",null)},500);h.data("lockedTimeout",b)}if(e){return}var f=a(this).closest(".expandable");var d=f.find("> ul");if(!f.hasClass("expanded")){f.addClass("expanded");d.show(ixwpsf.expandTime)}else{f.removeClass("expanded");d.hide(ixwpsf.retractTime)}});a(".product-search-form input.product-filter-field").prop("disabled",false);a(".product-search-filter-price-form input.product-search-filter-price-field").prop("disabled",false);a(".product-search-product_cat-filter-item a").on("click",ixwpsf.categoryFilterItemOnClick);a(".product-search-product_tag-filter-item").on("click",ixwpsf.tagFilterItemOnClick);a(".product-search-attribute-filter-item a").on("click",ixwpsf.attributeFilterItemOnClick);a(document).on("change input textInput",".product-search-filter-search input.product-filter-field",function(){var b=a(this).val().trim();if(b.length>0){a(this).parent().find(".product-search-filter-search-clear").show()}else{a(this).parent().find(".product-search-filter-search-clear").hide()}});a(document).on("click",".product-search-filter-search .product-search-filter-search-clear",function(){a(this).parent().find("input.product-filter-field").val("").trigger("input")});a(document).on("change input textInput",".product-search-filter-price input.product-search-filter-min-price, .product-search-filter-price input.product-search-filter-max-price",function(){var c=a(this).parent().find("input.product-search-filter-min-price").val().trim(),b=a(this).parent().find("input.product-search-filter-max-price").val().trim();if(c.length>0||b.length>0){a(this).parent().find(".product-search-filter-price-clear").show()}else{a(this).parent().find(".product-search-filter-price-clear").hide()}});a(document).on("click",".product-search-filter-price .product-search-filter-price-clear",function(){var e=a(this).parent().find("input.product-search-filter-min-price"),d=a(this).parent().find("input.product-search-filter-max-price"),c=false,b=false;if(e.length>0){if(e.val()!==""){e.val("");c=true}}if(d.length>0){if(d.val()!==""){d.val("");b=true}}if(c){e.trigger("input")}else{if(b){d.trigger("input")}}});ixwpsf.toggleWidgets()})})(jQuery);