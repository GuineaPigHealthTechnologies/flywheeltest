"use strict";(function(){!function(e,a){var v,o,i,_,h,t,u,c,l,r;if(e&&e.customize)v=e.customize,h=wc_voucher_template_preview,void 0,t=function(){var c,e;return e=v("wc_voucher_template_voucher_primary_image").get(),c=a("#voucher-image img"),e.width!==c.width()?h.image_scale=c.width()/e.width:h.image_scale=1,l("voucher",_(v("wc_voucher_template_voucher_font_size").get())),a.each(h.voucher_fields,function(e,t){var i,r,n,o,u;return i=a("#voucher #"+t),""===c.attr("src")?i.hide():(u=(u=v("wc_voucher_template_"+t+"_pos").get())?u.split(",").map(function(e){return parseInt(e,10)*h.image_scale}):null)?(o={left:u[0]+"px",top:u[1]+"px",width:u[2]+"px",height:u[3]+"px"},i.css(o).show(),r=null,(n=v("wc_voucher_template_"+t+"_font_size"))&&(r=n.get()),r?l(t,_(r)):void 0):i.hide()})},_=function(e){return e*(v("wc_voucher_template_voucher_image_dpi").get()/72*h.image_scale)},l=function(e,t){var i;return i=h.css_config.font_size,c(e,i,t)},c=function(e,t,i){var r;return r=i?t.value.replace("{$value}",i):"",a("#"+e).css(t.property,r)},u=function(){return a("#voucher-image img").imgAreaSelect({remove:!0}),t()},r=function(i){var e,t,r,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(a("#voucher-image img").attr("src"))return u(),a("#voucher #"+i).hide(),r=v("wc_voucher_template_"+i+"_pos").get(),t=v("wc_voucher_template_voucher_primary_image").get(),e=r?r.split(",").map(function(e){return parseInt(e,10)}):[null,null,null,null],a("#voucher-image img").imgAreaSelect({show:!0,handles:!0,instance:!0,imageWidth:t.width,imageHeight:t.height,x1:e[0],y1:e[1],x2:e[0]+e[2],y2:e[1]+e[3],aspectRatio:n,onSelectEnd:function(e,t){o(t,i)}})},o=function(e,t){var i;return i=[e.x1,e.y1,e.width,e.height],v.preview.send("voucher:update-position:"+t,i.join(","))},i=function(n){if(h.css_config)return a.each(h.css_config,function(t,i){var r;if(i.property)return i.value||(i.value="{$value}"),r=function(e){return"font_size"===t&&(e="0"===e?null:e)&&(e=_(e)),c(n,i,e)},v("wc_voucher_template_"+n+"_"+t,function(e){return r(e.get()),e.bind(r)})})},v("wc_voucher_template_voucher_primary_image",function(e){return e.bind(function(e){return a("#voucher-image img").prop("src",e.src).load(function(){return e.src?a("body").removeClass("voucher-no-image"):a("body").addClass("voucher-no-image"),t()})})}),v("wc_voucher_template_voucher_additional_image",function(e){return e.bind(function(e){return a("#voucher-additional-image img").prop("src",e)})}),v("wc_voucher_template_voucher_image_dpi",function(e){return e.bind(t)}),a(function(){return v.preview.bind("voucher:start-positioning",function(e){return r(e.field_id,e.aspect_ratio)}),v.preview.bind("voucher:stop-positioning",function(e){return u()}),v.preview.bind("voucher:remove-position",function(e){return t()}),v.preview.bind("voucher:update-position",function(e){return console.log("update...",e),t()}),a(window).resize(function(){return t()}),setTimeout(function(){return t(),i("voucher"),a.each(h.voucher_fields,function(e,t){return i(t)})},0),a("#voucher").click(".js-voucher-field-pos",function(e){return v.preview.send("voucher:click-position:"+e.target.id)})})}(window.wp,jQuery)}).call(void 0);