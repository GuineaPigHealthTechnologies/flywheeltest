"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){jQuery(function(_){var t,r,c,o,n,a,u,i,d,s,p,e,l,v,h,f,m,w,b,g;return l=null!=(v=window.wc_pdf_product_vouchers_admin)?v:{},null!=(h=window.typenow)?h:"",e=null!=(f=window.pagenow)?f:"",s=function(){return _(document.body).trigger("init_tooltips")},"wc_voucher"!==e&&"edit-wc_voucher"!==e||(s(),_(".page-title-action, .add-new-h2").on("click",function(e){return e.preventDefault(),_(this).pointer("toggle")}).on("pointercreate",function(){var o,t;return o=_(this),(t=o.data("wp-pointer").pointer).on("click",".close",function(e){return e.preventDefault(),o.pointer("close")}),t.on("click",".button-primary",function(e){return e.preventDefault(),t.find("form").submit()})}).on("pointeropened",function(e,o){return o.pointer.find("input:first").focus(),_(document.body).trigger("wc-enhanced-select-init")}).pointer({pointerClass:"create-voucher-pointer",content:function(){var e;return e=l.is_wc_version_gte_3_0?'<p><label for="search_product_id">'+l.i18n.product+'</label><select class="wc-product-search" name="product" id="search_product_id" style="width:100%" data-exclude="wc_pdf_product_vouchers_non_voucher_products" data-placeholder="'+l.i18n.search_for_product+'" data-allow_clear="true" ></select></p> <p><label for="search_product_id">'+l.i18n.purchaser+'</label><select class="wc-customer-search" name="customer" id="search_customer_id" style="width:100%" data-placeholder="'+l.i18n.guest+'" data-allow_clear="true" ></select></p>':'<p><input type="hidden" class="wc-product-search" name="product" id="search_product_id" style="width:100%" data-exclude="wc_pdf_product_vouchers_non_voucher_products" data-placeholder="'+l.i18n.search_for_product+'" data-allow_clear="true" /></p> <p><input type="hidden" class="wc-customer-search" name="customer" id="search_customer_id" style="width:100%" data-placeholder="'+l.i18n.guest+'" data-allow_clear="true" /></p>','<form method="get" action="'+l.new_voucher_url+'"> <input type="hidden" name="post_type" value="wc_voucher" /> <h3 class="wc-pdf-product-vouchers-voucher-create-voucher">'+l.i18n.select_product_and_purchaser+"</h3>"+e+"</form>"},buttons:function(){return _('<div> <a class="close wc-pdf-product-vouchers-redeem-voucher-pointer-close" href="#">'+l.i18n.cancel+'</a> <button class="button button-primary">'+l.i18n.add_voucher+"</button> </div>")}})),"wc_voucher"===e&&(_(".date-picker-field, .date-picker").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0}),c={message:g=null,overlayCSS:{background:"#fff",opacity:.6}},t=_.WCBackboneModal.View,m=function(e,o){return _("#wc-backbone-modal-dialog .modal-close").trigger("click"),new t({target:e,string:o})},p=function(){var e,o;return(o=_("#customer_id").val())?(e={user_id:o,action:"wc_pdf_product_vouchers_get_customer_details",security:l.get_customer_details_nonce},_(".voucher-purchaser-details div.edit-details").block(c),_.get(wc_pdf_product_vouchers_admin.ajax_url,e,function(e){return e.success&&_.each(e.data,function(e,o){return _(":input#_purchaser_"+e).val(o).change()}),_(".voucher-purchaser-details div.edit-details").unblock()})):(window.alert(l.i18n.no_customer_selected),!1)},o=function(){return _('.voucher-purchaser-details :input[name^="_purchaser_"]').each(function(){var e;return e=(e=_(this).attr("name")).replace("_purchaser_","_recipient_"),_(":input#"+e).val(_(this).val()).change()})},r=wp.media.view.MediaFrame.Select.extend({browseRouter:function(e){return e.set({browse:{text:_wpMediaViewsL10n.mediaLibraryTitle,priority:20}})}}),_(document.body).on("wc_backbone_modal_loaded",function(e,o){if("wc-voucher-modal-edit-product"===o)return _(document.body).trigger("wc-enhanced-select-init"),_(document.body).on("change.edit-product-modal","#voucher_product_id",function(e){var o;return _("#modal_voucher_product_price").closest("p").block(c),o={action:"wc_pdf_product_vouchers_get_product_details",product_id:e.target.value,security:wc_pdf_product_vouchers_admin.get_product_details_nonce},_.get(wc_pdf_product_vouchers_admin.ajax_url,o,function(e){var o;if(e.success&&e.data)return g=e.data,o=window.accounting.format(g.price,2,null,woocommerce_admin.mon_decimal_point),_("#modal_voucher_product_price").val(o).closest("p").unblock()})})}).on("wc_backbone_modal_removed",function(e,o){if("wc-voucher-modal-edit-product"===o)return _(document.body).off("change.edit-product-modal")}).on("wc_backbone_modal_response",function(e,o,t){var r;return _("#wc-pdf-product-vouchers-voucher-balance").block(c),r={action:"wc_pdf_product_vouchers_update_voucher_product",security:wc_pdf_product_vouchers_admin.update_voucher_product_nonce,voucher_id:_("#post_ID").val(),product_id:t.product_id,product_price:t.product_price},_.post(wc_pdf_product_vouchers_admin.ajax_url,r,function(e){return e.success&&e.data&&(_("#wc-pdf-product-vouchers-voucher-balance .inside").html(e.data.balance_html),e.data.preview_html&&_("#wc-pdf-product-vouchers-voucher-preview .inside").html(e.data.preview_html),s()),_("#wc-pdf-product-vouchers-voucher-balance").unblock()})}).on("keyup",".js-wc-pdf-vouchers-redeem-amount",function(){var e,o,t;return o=_("#voucher_remaining_value_for_display").val(),e=_("#voucher_product_price_for_display").val(),t=_("#voucher_type").val(),b(_(this),o,e,t)}).on("blur",".js-wc-pdf-vouchers-redeem-amount",function(){return _(".wc_error_tip").fadeOut("100",function(){return _(this).remove()})}),_("a.edit-voucher-details").on("click",function(e){return e.preventDefault(),_(this).hide(),_(this).parent().find("a:not(.edit-voucher-details)").show(),_(this).closest(".voucher_data_column").find("div.view-details").hide(),_(this).closest(".voucher_data_column").find("div.edit-details").show()}),_("a.load-customer-details").on("click",function(e){if(e.preventDefault(),window.confirm(l.i18n.confirm_load_customer_details))return p()}),_("a.copy-purchaser-details").on("click",function(e){if(e.preventDefault(),window.confirm(l.i18n.confirm_copy_purchaser_details))return o()}),_("#customer_id").data("original_customer_id",_("#customer_id").val()).on("change",function(){return _(this).val()!==_(this).data("original_customer_id")?(_("button.js-calculate-tax-action, button.js-redeem-action").prop("disabled",!0),_(".js-customer-changed-notice").show()):(_("button.js-calculate-tax-action, button.js-redeem-action").prop("disabled",!1),_(".js-customer-changed-notice").hide())}).change(),_("#wc-pdf-product-vouchers-voucher-notes").on("click",".js-add-note",function(e){var o,t;if(e.preventDefault(),t=_("textarea#voucher-note").val())return _("#wc-pdf-product-vouchers-voucher-notes").block(c),o={action:"wc_pdf_product_vouchers_add_voucher_note",voucher_id:_("#post_ID").val(),note:t,notify:_("#note-notify").is(":checked"),security:wc_pdf_product_vouchers_admin.add_voucher_note_nonce},_.post(wc_pdf_product_vouchers_admin.ajax_url,o,function(e){return e.success&&e.data&&_("ul.voucher-notes").prepend(e.data.note_html).find("ul.no-notes").hide(),_("#wc-pdf-product-vouchers-voucher-notes").unblock(),_("textarea#voucher-note").val("")})}).on("click","a.js-delete-note",function(e){var o,t;return e.preventDefault(),t=_(this).closest("li.note"),_(t).block(c),o={action:"wc_pdf_product_vouchers_delete_voucher_note",note_id:_(t).attr("rel"),security:wc_pdf_product_vouchers_admin.delete_voucher_note_nonce},_.post(wc_pdf_product_vouchers_admin.ajax_url,o,function(e){if(_(t).remove(),_("ul.voucher-notes").find("li:not(.no-notes)").length<1)return _("ul.voucher-notes").find("li.no-notes").show()})}),_("#wc-pdf-product-vouchers-voucher-balance").on("click",".js-edit-voucher-product",function(e){return e.preventDefault(),m("wc-voucher-modal-edit-product",{product_id:_('input[name="_product_id"]').val(),product_title:_(".product .wc-voucher-item-name").text(),product_price:_('input[name="_product_price"]').val()})}).on("click",".js-edit-voucher-redemption",function(e){return e.preventDefault(),_(this).closest("tr").find(".view").hide(),_(this).closest("tr").find(".edit").show(),_("div.wc-voucher-data-row.wc-voucher-edit-redemption-actions").slideDown(),_("div.wc-voucher-data-row-toggle").not("div.wc-voucher-data-row.wc-voucher-edit-redemption-actions").slideUp(),_("div.wc-voucher-data-row.wc-voucher-edit-redemption-actions button.js-cancel-action").attr("data-reload",!0),_("div.wc-voucher-totals-wrapper").slideDown(),_(this).hide()}).on("click",".js-redeem-action",function(e){return e.preventDefault(),_("div.wc-voucher-data-row.wc-voucher-redeem-actions").slideDown(),_("div.wc-voucher-data-row-toggle").not("div.wc-voucher-data-row.wc-voucher-redeem-actions").slideUp(),_("div.wc-voucher-totals-wrapper").slideUp(),_("div.wc-voucher-redeem-wrapper").slideDown(),_(".edit-voucher-item").hide()}).on("click",".js-void-action",function(e){return e.preventDefault(),_("div.wc-voucher-data-row.wc-voucher-void-actions").slideDown(),_("div.wc-voucher-data-row-toggle").not("div.wc-voucher-data-row.wc-voucher-void-actions").slideUp(),_("div.wc-voucher-totals-wrapper").slideUp(),_("div.wc-voucher-void-wrapper").slideDown(),_(".edit-voucher-item").hide()}).on("click",".js-calculate-tax-action",function(e){var o;if(e.preventDefault(),window.confirm(l.i18n.confirm_calculate_taxes))return _("#wc-pdf-product-vouchers-voucher-balance").block(c),o={action:"wc_pdf_product_vouchers_calculate_voucher_product_tax",security:wc_pdf_product_vouchers_admin.voucher_balance_nonce,voucher_id:_("#post_ID").val()},_.post(wc_pdf_product_vouchers_admin.ajax_url,o,u)}).on("click",".js-delete-voucher-redemption",function(e){var o;if(e.preventDefault(),window.confirm(l.i18n.confirm_delete_redemption))return _("#wc-pdf-product-vouchers-voucher-balance").block(c),o={action:"wc_pdf_product_vouchers_delete_voucher_redemption",security:wc_pdf_product_vouchers_admin.voucher_balance_nonce,voucher_id:_("#post_ID").val(),redemption_key:_(e.target).closest("tr").data("key")},_.post(wc_pdf_product_vouchers_admin.ajax_url,o,u)}).on("click",".js-cancel-action",function(e){var o,t;if(_("div.wc-voucher-data-row-toggle").not("div.wc-voucher-balance-actions").slideUp(),_("div.wc-voucher-balance-actions").slideDown(),_("div.wc-voucher-totals-wrapper").slideDown(),_(".edit-voucher-item").show(),"true"===(o=_(this)).attr("data-reload"))return _("#wc-pdf-product-vouchers-voucher-balance").block(c),t={action:"wc_pdf_product_vouchers_load_voucher_redemptions",security:wc_pdf_product_vouchers_admin.voucher_balance_nonce,voucher_id:_("#post_ID").val()},_.post(wc_pdf_product_vouchers_admin.ajax_url,t,function(e){return e.success&&e.data&&(_("tbody#voucher-redemptions").replaceWith(e.data.redemptions_html),s(),o.attr("data-reload","false")),_("#wc-pdf-product-vouchers-voucher-balance").unblock()})}).on("click",".js-redeem-voucher-action",function(e){var o,t;return e.preventDefault(),t=_("#redemption_amount").val(),"incl"===wc_pdf_product_vouchers_admin.tax_display_shop&&_("#voucher_tax").val()&&(t/=1+_("#voucher_tax").val()/_("#voucher_value").val()),o={action:"wc_pdf_product_vouchers_redeem_voucher",security:wc_pdf_product_vouchers_admin.voucher_balance_nonce,voucher_id:_("#post_ID").val(),amount:t,notes:_("#redemption_notes").val()},_("#wc-pdf-product-vouchers-voucher-balance").block(c),_.post(wc_pdf_product_vouchers_admin.ajax_url,o,u)}).on("click",".js-void-voucher-action",function(e){var o;if(e.preventDefault(),window.confirm(l.i18n.confirm_void_voucher))return _("#wc-pdf-product-vouchers-voucher-balance").block(c),o={action:"wc_pdf_product_vouchers_void_voucher",security:wc_pdf_product_vouchers_admin.voucher_balance_nonce,voucher_id:_("#post_ID").val(),reason:_("#void_reason").val()},_.post(wc_pdf_product_vouchers_admin.ajax_url,o,u)}).on("click",".js-restore-action",function(e){var o;if(e.preventDefault(),window.confirm(l.i18n.confirm_restore_voucher))return _("#wc-pdf-product-vouchers-voucher-balance").block(c),o={action:"wc_pdf_product_vouchers_restore_voucher",security:wc_pdf_product_vouchers_admin.voucher_balance_nonce,voucher_id:_("#post_ID").val()},_.post(wc_pdf_product_vouchers_admin.ajax_url,o,u)}).on("click",".js-save-redemptions-action",function(e){var o,t,r;return e.preventDefault(),t=_("tbody#voucher-redemptions :input[name]").serializeArray(),"incl"===wc_pdf_product_vouchers_admin.tax_display_shop&&_("#voucher_tax").val()&&(r=_("#voucher_tax").val()/_("#voucher_value").val(),t.forEach(function(e,o){if(0<e.name.lastIndexOf("[amount]"))return t[o].value=e.value/(1+r)})),o={action:"wc_pdf_product_vouchers_save_voucher_redemptions",security:wc_pdf_product_vouchers_admin.voucher_balance_nonce,voucher_id:_("#post_ID").val(),data:_.param(t)},_("#wc-pdf-product-vouchers-voucher-balance").block(c),_.post(wc_pdf_product_vouchers_admin.ajax_url,o,u)}),n=null,a=_("#_voucher_image_options").val(),_("#wc-pdf-product-vouchers-voucher-preview").on("click",".js-select-voucher-image",function(e){var o,t;if(e.preventDefault(),t=_wpMediaViewsL10n,o=_("#_voucher_image_options").val(),!n||a!==o)return a=o,(n=new r({button:{text:t.chooseImage},states:new wp.media.controller.Library({title:t.chooseImage,library:wp.media.query({type:"image",include:a.split(",")}),multiple:!1,searchable:!1,date:!1,content:"browse"})})).on("open",function(){var e,o;return o=n.state().get("selection"),e=_("#_thumbnail_id").val(),o.add(wp.media.attachment(e))}),n.on("select",function(){var e,o;if((o=n.state().get("selection").first().toJSON())&&o.id)return e={voucher_id:_("#post_ID").val(),image_id:o.id,action:"wc_pdf_product_vouchers_get_voucher_preview",security:l.get_voucher_preview_nonce},_("#wc-pdf-product-vouchers-voucher-preview .inside").block(c),_.get(wc_pdf_product_vouchers_admin.ajax_url,e,function(e){return e.success&&_("#wc-pdf-product-vouchers-voucher-preview .inside").html(e.data.preview_html),_("#wc-pdf-product-vouchers-voucher-preview .inside").unblock()})}),n.open();n.open()})),"edit-wc_voucher"===e&&(_(".redeem").on("click",function(e){return e.preventDefault(),_(this).pointer("toggle")}).on("pointercreate",function(){var o,t,e,r,c,n,a;return o=_(this),t=o.data("wp-pointer").pointer,a=o.closest(".voucher_actions").find(".voucher-type").val(),e=o.closest(".voucher_actions").find(".voucher-product-price-for-display").val(),n=o.closest(".voucher_actions").find(".voucher-value").val(),c=o.closest(".voucher_actions").find(".voucher-tax").val(),r=o.closest(".voucher_actions").find(".voucher-remaining-value-for-display").val(),t.data("voucher-type",a),t.data("voucher-product-price",e),t.data("voucher-value",n),t.data("voucher-tax",c),t.data("voucher-remaining-value",r),t.on("submit","form",function(e){return e.preventDefault(),i(t)}),t.on("click",".button-primary",function(e){return e.preventDefault(),i(t)}),t.on("click",".close",function(e){return e.preventDefault(),o.pointer("close")})}).on("pointeropened",function(e,o){return o.pointer.find("input:first").focus()}).pointer({pointerClass:"redeem-voucher-pointer",position:{edge:"top",at:"center bottom",my:"right+63 top"},content:function(){var e,o,t;return t=(e=_(this)).attr("href"),o=e.closest("p").find(".voucher-remaining-value-for-display").val(),'<form method="get" action="'+t+'"> <h3 class="wc-pdf-product-vouchers-voucher-redeem-voucher">'+l.i18n.redeem_voucher+"</h3> <p> <label>"+l.i18n.amount_label+'<input type="text" name="amount" class="large-text js-wc-pdf-vouchers-redeem-amount" value="'+window.accounting.format(o,2,null,woocommerce_admin.mon_decimal_point)+'" /> </label> </p> <p> <label>'+l.i18n.notes_label+'<textarea name="notes" class="large-text"></textarea> </label> </p> </form>'},buttons:function(){return _('<div> <a class="close wc-pdf-product-vouchers-redeem-voucher-pointer-close" href="#">'+l.i18n.cancel+'</a> <button class="button button-primary">'+l.i18n.redeem+"</button> </div>")}}),_(document.body).on("keyup",".js-wc-pdf-vouchers-redeem-amount",function(){var e;return e=_(this).closest(".redeem-voucher-pointer"),b(_(this),e.data("voucher-remaining-value"),e.data("voucher-product-price"),e.data("voucher-type"))}).on("blur",".js-wc-pdf-vouchers-redeem-amount",function(){return _(".wc_error_tip").fadeOut("100",function(){return _(this).remove()})}),_(".void").on("click",function(e){return e.preventDefault(),_(this).pointer("toggle")}).on("pointercreate",function(){var o,t;return o=_(this),(t=o.data("wp-pointer").pointer).on("submit","form",function(e){return e.preventDefault(),d(t)}),t.on("click",".button-primary",function(e){return e.preventDefault(),setTimeout(function(){return d(t)},0)}),t.on("click",".close",function(e){return e.preventDefault(),o.pointer("close")})}).on("pointeropened",function(e,o){return o.pointer.find("input:first").focus()}).pointer({pointerClass:"void-voucher-pointer",position:{edge:"top",at:"center bottom",my:"right+63 top"},content:function(){var e,o;return o=(e=_(this)).attr("href"),e.closest("p").find(".voucher-remaining-value").val(),'<form method="get" action="'+o+'"> <h3 class="wc-pdf-product-vouchers-voucher-void-voucher">'+l.i18n.void_remaining_value+"</h3> <p> <label>"+l.i18n.reason_label+'<textarea name="notes" class="large-text"></textarea> </label> </p> </form>'},buttons:function(){return _('<div> <a class="close wc-pdf-product-vouchers-void-voucher-pointer-close" href="#">'+l.i18n.cancel+'</a> <button class="button button-primary">'+l.i18n.void+"</button> </div>")}})),"product"===e&&(w=function(){var e;if(e=_("input#_has_voucher:checked").length,_(".hide_if_has_voucher").show(),_(".show_if_has_voucher").hide(),e)return _(".show_if_has_voucher").show()},_(document.body).on("woocommerce-product-type-change",function(e,o){return"variable"!==o&&"grouped"!==o&&"external"!==o&&"variable-subscription"!==o||_("input#_has_voucher").prop("checked",!1).change(),w()}),_("input#_has_voucher").on("change",function(){return w()}),_("input#_has_voucher").change(),_("#variable_product_options").on("change","input.variable_has_voucher",function(){if(_(this).closest(".woocommerce_variation").find(".show_if_variation_has_voucher").hide(),_(this).is(":checked"))return _(this).closest(".woocommerce_variation").find(".show_if_variation_has_voucher").show()}),_("input.variable_has_voucher").change(),_("#woocommerce-product-data").on("woocommerce_variations_loaded",function(e,o){if(!(o=o||!1))return _("input.variable_has_voucher").change()})),_.extend(woocommerce_admin,{pdf_product_vouchers_i18n_amount_greater_than_zero_error:l.i18n.amount_greater_than_zero_error,pdf_product_vouchers_i18n_amount_less_or_equal_to_remaining_error:l.i18n.amount_less_or_equal_to_remaining_error,pdf_product_vouchers_i18n_amount_multiple_of_product_price_error:l.i18n.amount_multiple_of_product_price_error}),b=function(o,e){var t,r,c,n,a,u,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"multi";return n=new RegExp("[^0-9\\"+woocommerce_admin.mon_decimal_point+"]+","gi"),c=(u=o.val()).replace(n,""),t=parseFloat(window.accounting.unformat(u,woocommerce_admin.mon_decimal_point)),r=(a=[{error:"i18n_mon_decimal_error",invalid:u!==c},{error:"pdf_product_vouchers_i18n_amount_multiple_of_product_price_error",invalid:"single"===d&&t%i},{error:"pdf_product_vouchers_i18n_amount_greater_than_zero_error",invalid:!t||t<0},{error:"pdf_product_vouchers_i18n_amount_less_or_equal_to_remaining_error",invalid:e<t}]).filter(function(e){return e.invalid}),a.filter(function(e){return!e.invalid}).forEach(function(e){return r.length?o.parent().find(".wc_error_tip."+e.error).remove():_(document.body).triggerHandler("wc_remove_error_tip",[o,e.error])}),!r.length||(_(document.body).triggerHandler("wc_add_error_tip",[o,r.shift().error]),!1)},i=function(a){var u;return u=a.find('input[name="amount"]'),setTimeout(function(){var e,o,t,r,c,n;return b(u,a.data("voucher-remaining-value"),a.data("voucher-product-price"),a.data("voucher-type"))?(c=(e=a.find("form")).attr("action"),n=a.data("voucher-value"),t=a.data("voucher-tax"),(o={amount:e.find('input[name="amount"]').val(),notes:e.find('input[name="notes"]').val()}).amount=parseFloat(window.accounting.unformat(o.amount,woocommerce_admin.mon_decimal_point)),"incl"===wc_pdf_product_vouchers_admin.tax_display_shop&&t&&(r=t/n,o.amount=o.amount/(1+r)),c=c+"&"+_.param(o),window.location.href=c):u.focus()})},d=function(e){var o,t;return t=(t=(o=e.find("form")).attr("action"))+"&"+o.serialize(),window.location.href=t},u=function(e){var o,t;return"object"!==(void 0===e?"undefined":_typeof(e))||e.success?e.success&&e.data&&(t=e.data,_("#wc-pdf-product-vouchers-voucher-balance .inside").html(t.balance_html),o=_("#post_status").val().replace("wcpdf-",""),t.status&&t.status!==o&&(_("#post_status").val("wcpdf-"+t.status).change(),t.notes_html&&_("#wc-pdf-product-vouchers-voucher-notes ul.voucher-notes").replaceWith(t.notes_html)),s()):alert(e.data.message),_("#wc-pdf-product-vouchers-voucher-balance").unblock()}})}).call(void 0);